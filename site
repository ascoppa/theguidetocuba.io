#!/usr/bin/env ruby

require "json"
require "mote"
require "redcarpet"

class Site
  include Mote::Helpers

  def initialize(markdown)
    @markdown = markdown
  end

  def generate
    return mote("templates/online.mote", content: content, toc: toc)
  end

  def content
    options = { tables: true, fenced_code_blocks: true }
    renderer = Redcarpet::Render::HTML.new(with_toc_data: true)

    return Redcarpet::Markdown.new(renderer, options).render(@markdown)
  end

  def toc
    return Redcarpet::Markdown.new(Redcarpet::Render::HTML_TOC).render(@markdown)
  end
end

puts(Site.new(File.read(ARGV[0])).generate)
